---
title: "GASã§ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ•ã‚©ãƒ¼ãƒ ã¤ããƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’å®Ÿè£…ã™ã‚‹"
emoji: "ğŸ’­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["gas"]
published: false
---

# ã¯ã˜ã‚ã«

Google Apps Scriptï¼ˆä»¥ä¸‹ã€GASï¼‰ã‚’ä½¿ã£ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã—ã¦ã„ã‚‹ã¨ã€ãªã‚“ã‚‰ã‹ã®è¨­å®šå€¤ã‚’ç”»é¢ã‹ã‚‰å…¥åŠ›ã•ã›ã‚‹ã—ãã¿ãŒå¿…è¦ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
ä¾‹ãˆã° Slack ã¨é€£æºã™ã‚‹æ©Ÿèƒ½ã«ãŠã„ã¦ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚„ Webhook URL ã‚’ã‚³ãƒ¼ãƒ‰ã«ã¯ç›´æ¥åŸ‹ã‚è¾¼ã¾ãšãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å…¥åŠ›ã•ã›ãŸã„ã€ãªã©ã§ã™ã€‚

ã‚„ã‚ŠãŸã„ã“ã¨ã¯éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ãŒã€èª¿ã¹ã¦ã¿ã‚‹ã¨ãªã‹ãªã‹ã¾ã¨ã¾ã£ãŸæƒ…å ±ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸãŸã‚ã€æœ¬è¨˜äº‹ã§ã¯ã“ã®ã‚ˆã†ãªã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å…¥åŠ›ã‚’å—ã‘å–ã£ã¦ä¿å­˜ã™ã‚‹ã€æ©Ÿèƒ½ã®å®Ÿè£…æ–¹æ³•ã«ã¤ã„ã¦ç°¡å˜ã«ã¾ã¨ã‚ã¾ã™ã€‚

# ã“ã®è¨˜äº‹ã§ä½œã‚‹ã‚‚ã®

æœ¬è¨˜äº‹ã§å®Ÿè£…ã™ã‚‹ã®ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ©Ÿèƒ½ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/0075fe930ae4-20220925.gif)

- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹
- ãƒ€ã‚¤ã‚¢ãƒ­ã‚°å†…ã®ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã—ã¦ä¿å­˜ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€å…¥åŠ›å€¤ã‚’ä¿å­˜ã™ã‚‹
- ä¿å­˜æˆåŠŸæ™‚ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹
- æ¬¡å›ä»¥é™ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã„ãŸã¨ãã«ã¯ã€ä¿å­˜æ¸ˆã¿ã®å€¤ãŒåˆæœŸå€¤ã¨ã—ã¦ã‚»ãƒƒãƒˆã•ã‚Œã‚‹

å‰æã¨ã—ã¦ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¨é€£æºã—ãŸ GAS ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ãŒã€ã‚³ãƒ¼ãƒ‰ã®ä¸€éƒ¨ï¼ˆ`SpreadsheetApp` ãªã©ï¼‰ã‚’å¤‰ãˆã‚Œã°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç­‰ã«ã‚‚è»¢ç”¨ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

# å®Ÿè£…æ–¹æ³•

## 1. åŸºæœ¬ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’ä½œã‚‹

ã¾ãšã€åŸºæœ¬ã¨ãªã‚‹ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ã¨ã“ã‚ã¾ã§å®Ÿè£…ã—ã¾ã™ã€‚
GAS ã«ãŠã„ã¦ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã®ã‚ˆã†ã«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°å†…ã«ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã‚’è¨­ç½®ã—ãŸã„å ´åˆã€ã‚«ã‚¹ã‚¿ãƒ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’ä½¿ã„ã¾ã™ã€‚
å‚è€ƒ: https://developers.google.com/apps-script/guides/dialogs#custom_dialogs

ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆã“ã“ã§ã¯ `Code.gs`ï¼‰ã«åŠ ãˆã€ç‹¬ç«‹ã—ãŸ HTML ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã“ã“ã§ã¯ `Dialog.html`ï¼‰ã‚’ç”¨æ„ã—ã¾ã™ã€‚

```javascript:Code.gs
function onOpen() {
  SpreadsheetApp.getUi() // Or DocumentApp or SlidesApp or FormApp.
    .createMenu("Custom Menu")
    .addItem("Show dialog", "showDialog")
    .addToUi();
}

function showDialog() {
  const html = HtmlService.createHtmlOutputFromFile("Dialog")
    .setWidth(400)
    .setHeight(300);
  SpreadsheetApp.getUi() // Or DocumentApp or SlidesApp or FormApp.
    .showModalDialog(html, "My custom dialog");
}
```

```html:Dialog.html
<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
  </head>
  <body>
    <h1>Hello, World!</h1>
  </body>
</html>
```

ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ä½œæˆã—ã¦ã„ã‚‹ç®‡æ‰€ã‚’é™¤ã‘ã°ã€ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºã®ãŸã‚ã«ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯ä»¥ä¸‹ã® 2 ã¤ã§ã™ã€‚

1. [`HtmlService.createHtmlOutputFromFile(filename)`](https://developers.google.com/apps-script/reference/html/html-service#createhtmloutputfromfilefilename) ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã« HTML ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ¸¡ã™
   - ãƒ¡ã‚½ãƒƒãƒ‰ã®æˆ»ã‚Šå€¤ã¯ [`HtmlOutput`](https://developers.google.com/apps-script/reference/html/html-output.html) ã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
2. 1 ã®æˆ»ã‚Šå€¤ã‚’ [`Ui.showModalDialog()`](https://developers.google.com/apps-script/reference/base/ui#showmodaldialoguserinterface,-title) ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã«æ¸¡ã™

ã“ã®ã‚³ãƒ¼ãƒ‰ã®çµæœã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/50e6564c0686-20220922.gif)

## 2. ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œã‚Šã€ é€ä¿¡ã•ã‚ŒãŸå€¤ã‚’å—ã‘å–ã‚‹

ç¶šã„ã¦ã€ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã«ãƒ•ã‚©ãƒ¼ãƒ æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã¾ãšã€ `Code.gs` ã«ã¯ä»¥ä¸‹ã®é–¢æ•°ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```javascript:Code.gs(æŠœç²‹)
function processForm(formObject) {
  console.log(`Hello, ${formObject.name}!`);
}
```

ç¶šã„ã¦ `Dialog.html` ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```html:Dialog.html
<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <script>
      // Prevent forms from submitting.
      function preventFormSubmit() {
        const forms = document.querySelectorAll("form");
        forms.forEach((form) => {
          form.addEventListener("submit", function (event) {
            event.preventDefault();
          });
        });
      }
      window.addEventListener("load", preventFormSubmit);

      function handleFormSubmit(formObject) {
        google.script.run.processForm(formObject);
      }
    </script>
  </head>
  <body>
    <form id="myForm" onsubmit="handleFormSubmit(this)">
      <input name="name" type="text" />
      <input type="submit" value="Submit" />
    </form>
  </body>
</html>
```

form ã‚’è¨­ç½®ã—ã€ãã® submit ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©å†…ã§ `google.script.run.processForm()` ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚ [`google.script.run`](https://developers.google.com/apps-script/guides/html/reference/run) ã¯ HTML ã‹ã‚‰ Apps Script ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™ãŸã‚ã® API ã§ã™ã€‚
ã‚¹ã‚¯ãƒªãƒ—ãƒˆå´ã¯æ¸¡ã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­èº«ã‚’ `console.log` ã«å‡ºåŠ›ã—ã¦ã„ã‚‹ã ã‘ã§ã™ãŒã€ã¡ã‚ƒã‚“ã¨é€ã‚‰ã‚Œã¦ãã¦ã„ã‚‹ã®ã‚’ç¢ºèªã§ãã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/559d65dc83c4-20220924.png)

ãªãŠã€ `preventFormSubmit()` ã§ã¯ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¦ã„ã¾ã™ã€‚
ã“ã‚Œã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã® https://developers.google.com/apps-script/guides/html/communication#forms ã«ã¯

> Note that upon loading all forms in the page have the default submit action disabled by `preventFormSubmit`. This prevents the page from redirecting to an inaccurate URL in the event of an exception.

ã¨è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚ `in the event of an exception` ã¨æ›¸ã‹ã‚Œã¦ã¯ã„ã¾ã™ãŒã€ç¢ºèªã—ãŸé™ã‚Šã§ã¯ã“ã®å‡¦ç†ã‚’çœãã¨æˆåŠŸæ™‚ã§ã‚‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ãŸãŸã‚ã€æ®‹ã—ã¦ãŠã„ãŸæ–¹ãŒã‚ˆã•ãã†ã§ã™ã€‚

```
Unsafe attempt to initiate navigation for frame with origin 'https://docs.google.com' from frame with URL 'https://n-gxieqqv47obd6y...4i-0lu-script.googleusercontent.com/userCodeAppPanel'. The frame attempting navigation of the top-level window is sandboxed, but the flag of 'allow-top-navigation' or 'allow-top-navigation-by-user-activation' is not set.
```

## 3. ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹

å…ˆã»ã©ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ã‚’ã‚¹ã‚¯ãƒªãƒ—ãƒˆå´ã«é€ä¿¡ã§ããŸãŸã‚ã€ä¿å­˜å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã™ã€‚
ã‚¹ã‚¯ãƒªãƒ—ãƒˆã® `processForm()` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```javascript:Code.gs(æŠœç²‹)
function processForm(formObject) {
  const userProperties = PropertiesService.getUserProperties();
  userProperties.setProperties({
    name: formObject.name,
  });
}
```

`PropertiesService` ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€key-value å½¢å¼ã§ä»»æ„ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã§ãã¾ã™ã€‚
ã“ã“ã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ã®è¨­å®šå€¤ã‚’ä¿å­˜ã™ã‚‹ã¨ã„ã†æƒ³å®šã§ User Properties ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§åŒã˜å€¤ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã® Script Properties ã‚‚ã‚ã‚Šã¾ã™ã€‚
è©³ã—ãã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã® https://developers.google.com/apps-script/guides/properties ã‚’å‚ç…§ãã ã•ã„ã€‚

## 4. å‡¦ç†çµæœã‚’ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã«è¡¨ç¤ºã™ã‚‹

ã“ã“ã¾ã§ã§ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ã‚’ä¿å­˜ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸãŒã€ä¿å­˜ãŒæˆåŠŸã—ãŸã“ã¨ãŒãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä¸Šã‹ã‚‰ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚
ãã®ãŸã‚ã€æ¬¡ã«ã€Œä¿å­˜ã«æˆåŠŸã—ãŸã‚‰ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä¸Šã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã€ã¨ã„ã†å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã™ã€‚

`Dialog.html` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```diff:Dialog.html
 <!DOCTYPE html>
 <html>
   <head>
     <base target="_top" />
     <script>
       // Prevent forms from submitting.
       function preventFormSubmit() {
         const forms = document.querySelectorAll("form");
         forms.forEach((form) => {
           form.addEventListener("submit", function (event) {
             event.preventDefault();
           });
         });
       }
       window.addEventListener("load", preventFormSubmit);

+      function onSuccess() {
+        const div = document.getElementById("success-output");
+        div.innerHTML = "Successfully saved";
+      }
+
       function handleFormSubmit(formObject) {
-        google.script.run.processForm(formObject);
+        google.script.run.withSuccessHandler(onSuccess).processForm(formObject);
       }
     </script>
   </head>
   <body>
     <form id="myForm" onsubmit="handleFormSubmit(this)">
       <input name="name" type="text" />
       <input type="submit" value="Submit" />
     </form>
+    <div id="success-output"></div>
   </body>
 </html>
```

`google.script.run` ã« [`withSuccessHandler(Function)`](https://developers.google.com/apps-script/guides/html/reference/run#withsuccesshandlerfunction) ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚
ã“ã‚Œã¯æ–‡å­—é€šã‚Šã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆå´ã®é–¢æ•°ï¼ˆã“ã“ã§ã¯ `processForm`ï¼‰ãŒæˆåŠŸã—ãŸã¨ãã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚åŒæ§˜ã«ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆå´ã®é–¢æ•°ãŒå¤±æ•—ã—ãŸã¨ãã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ [`withFailureHandler(Function)`](https://developers.google.com/apps-script/guides/html/reference/run#withfailurehandlerfunction) ã‚‚ã‚ã‚Šã€ã“ã‚Œã‚‰ã¯ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã§ã¤ãªã’ã‚‰ã‚Œã¾ã™ã€‚
ã¾ãŸã€ **ã‚¹ã‚¯ãƒªãƒ—ãƒˆå´ã®é–¢æ•°ã«æˆ»ã‚Šå€¤ãŒã‚ã‚‹å ´åˆã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®ç¬¬ä¸€å¼•æ•°ã«ã¯æˆ»ã‚Šå€¤ãŒæ¸¡ã•ã‚Œã¾ã™ã€‚**

æˆåŠŸã—ãŸã“ã¨ã‚’ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®æ–¹æ³•ã¯è‰²ã€…ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ã“ã“ã§ã¯ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã—ã¦ãŠã„ãŸ div è¦ç´ ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã¨ã„ã†ç´ æœ´ãªæ–¹æ³•ã‚’ã¨ã£ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€å‡¦ç†ãŒå®Œäº†ã—ãŸã“ã¨ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰è¦‹ã¦ã‚‚ã‚ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/e756393a52e1-20220925.gif)

## 5. ä¿å­˜æ¸ˆã¿ã®å€¤ã‚’åˆæœŸå€¤ã¨ã—ã¦ã‚»ãƒƒãƒˆã™ã‚‹

ä»Šã®ã¾ã¾ã§ã¯éå»ã«ä¿å­˜ã—ãŸå€¤ãŒå­˜åœ¨ã™ã‚‹ã®ã‹ã€ã¾ãŸãã®å€¤ãŒä½•ãªã®ã‹ã‚’çŸ¥ã‚‹è¡“ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
ãã“ã§ã€ã™ã§ã«ä¿å­˜æ¸ˆã¿ã®å€¤ãŒã‚ã£ãŸå ´åˆã€ãƒ•ã‚©ãƒ¼ãƒ ã®åˆæœŸå€¤ã¨ã—ã¦ã‚»ãƒƒãƒˆã™ã‚‹å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã™ã€‚

`Code.gs` ã§ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã—ã¦ã„ãŸéƒ¨åˆ†ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```diff:Code.gsï¼ˆæŠœç²‹ï¼‰
 function showDialog() {
-  const html = HtmlService.createHtmlOutputFromFile("Dialog")
-    .setWidth(400)
-    .setHeight(300);
+  const template = HtmlService.createTemplateFromFile("Dialog");
+  template.name = getName();
+  const html = template.evaluate().setWidth(400).setHeight(300);
   SpreadsheetApp.getUi() // Or DocumentApp or SlidesApp or FormApp.
     .showModalDialog(html, "My custom dialog");
 }

+function getName() {
+  const userProperties = PropertiesService.getUserProperties();
+  return userProperties.getProperty("name");
+}
+
```

ã¾ãŸã€ `Dialog.html` ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã« `value` ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```diff:Dialog.htmlï¼ˆæŠœç²‹ï¼‰
   <body>
     <form id="myForm" onsubmit="handleFormSubmit(this)">
-      <input name="name" type="text" />
+      <input name="name" type="text" value="<?= name ?>" />
       <input type="submit" value="Submit" />
     </form>
     <div id="success-output"></div>
```

`Code.gs` ã®å¤‰æ›´ç‚¹ã§ã™ãŒã€ã“ã‚Œã¾ã§ `createHtmlOutputFromFile(filename)` ã‚’ä½¿ç”¨ã—ã¦ã„ãŸã®ãŒ [`createTemplateFromFile(filename)`](https://developers.google.com/apps-script/reference/html/html-service#createtemplatefromfilefilename) ã«å¤‰ã‚ã£ã¦ã„ã¾ã™ã€‚
ã“ã†ã™ã‚‹ã¨ã€å¼•æ•°ã§æ¸¡ã—ãŸ HTML ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ `<?= foo ?>` ã§å¤‰æ•°ã‚’åŸ‹ã‚è¾¼ã‚“ã ã‚Šã€ `<? ... ?>` ã¨ã„ã†æ§‹æ–‡ã§ if ã‚„ for æ–‡ãªã©ä»»æ„ã®å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ï¼ˆ[Pug](https://pugjs.org/api/getting-started.html) ã‚„ [EJS](https://ejs.co/) ãªã©ã¨ä¼¼ãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã€ã¨æ‰ãˆã¦ã„ãŸã ãã¨ã‚ã‹ã‚Šã‚„ã™ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼‰

è©³ã—ãã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã® https://developers.google.com/apps-script/guides/html/templates ã‚’å‚ç…§ãã ã•ã„ã€‚

`createTemplateFromFile(filename)` ãŒè¿”ã™ã®ã¯ `HtmlTemplate` ã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ãªã‚Šã€ã“ã‚Œã«ä»»æ„ã®å¤‰æ•°ï¼ˆã“ã“ã§ã¯ `template.name = ...`ï¼‰ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã¨ HTML å´ã‹ã‚‰å‚ç…§ã§ãã¾ã™ï¼ˆ`<?= name ?>`ï¼‰ã€‚
ã¾ãŸã€ã“ã‚Œã‚’ `evaluate()` ã—ãŸçµæœãŒ `HtmlOutput` ã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ãªã‚Šã€ `createHtmlOutputFromFile(filename)` ã®æˆ»ã‚Šå€¤ã¨åŒã˜ã‚‚ã®ã§ã™ã€‚

`getName()` å†…ã§ã¯ User Properties ã‹ã‚‰å€¤ã‚’å–ã‚Šå‡ºã—ã¦ã„ã¾ã™ã€‚
ä¸Šã®ã‚³ãƒ¼ãƒ‰ã®ã‚ˆã†ã« [`getProperty(key)`](https://developers.google.com/apps-script/reference/properties/properties#getpropertykey) ã§ç‰¹å®šã®å€¤ã‚’å–ã‚Šå‡ºã™ã‹ã€ [`getProperties()`](https://developers.google.com/apps-script/reference/properties/properties#getproperties) ã§ã™ã¹ã¦ã® key-value ã®ãƒšã‚¢ã‚’å–ã‚Šå‡ºã™ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

## 6. ï¼ˆãŠã¾ã‘ï¼‰CSS ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’åˆ©ç”¨ã™ã‚‹

æœ€å¾Œã«ãŠã¾ã‘ã§ã€å¤–éƒ¨ã® CSS ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã£ã¦ãƒ•ã‚©ãƒ¼ãƒ ã®è¦‹ãŸç›®ã‚’æ•´ãˆã¾ã™ã€‚
GAS ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¯ä¸€èˆ¬çš„ãª HTML ã¨åŒã˜ã‚ˆã†ã« `<link>` ã‚¿ã‚°ã§å¤–éƒ¨ã® CSS ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚ãã®ãŸã‚ã€CDN ã§é…ä¿¡ã•ã‚Œã¦ã„ã‚‹ CSS ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãªã©ã§ã‚ã‚Œã°æ¯”è¼ƒçš„ç°¡å˜ã«åˆ©ç”¨ã§ãã¾ã™ã€‚
ã“ã“ã§ã¯ãã®ä¸€ä¾‹ã¨ã—ã¦ GitHub ãŒé–‹ç™ºã—ã¦ã„ã‚‹ [Primer CSS](https://primer.style/css/) ã‚’ä½¿ã£ã¦ã¿ã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã§ã™ï¼ˆé•·ã„ã®ã§æŠ˜ã‚ŠãŸãŸã‚“ã§ã„ã¾ã™ï¼‰ã€‚

:::details Dialog.html

```html
<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <link
      href="https://unpkg.com/@primer/css@^20.2.4/dist/primer.css"
      rel="stylesheet"
    />
    <script>
      // Prevent forms from submitting.
      function preventFormSubmit() {
        const forms = document.querySelectorAll("form");
        forms.forEach((form) => {
          form.addEventListener("submit", function (event) {
            event.preventDefault();
          });
        });
      }
      window.addEventListener("load", preventFormSubmit);

      function onSuccess() {
        const success = document.getElementById("success");
        success.style.display = "block";
      }

      function handleFormSubmit(formObject) {
        google.script.run.withSuccessHandler(onSuccess).processForm(formObject);
      }
    </script>
  </head>
  <body>
    <div id="success" class="flash flash-success" style="display: none">
      <!-- <%= octicon "check" %> -->
      <svg
        class="octicon"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 16 16"
        width="16"
        height="16"
      >
        <path
          fill-rule="evenodd"
          d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"
        ></path>
      </svg>
      Saved successfully
    </div>
    <div id="form">
      <form id="myForm" onsubmit="handleFormSubmit(this)">
        <div class="form-group">
          <div class="form-group-header">
            <label for="name">Name</label>
          </div>
          <div class="form-group-body">
            <input
              class="form-control input-block"
              id="name"
              name="name"
              type="text"
              value="<?= name ?>"
            />
          </div>
        </div>
        <div class="form-actions">
          <button class="btn btn-primary" type="submit">Submit</button>
        </div>
      </form>
    </div>
  </body>
</html>
```

:::

ã“ã‚Œã§ã€å†’é ­ã® GIF ã§ç´¹ä»‹ã—ãŸã‚ˆã†ãªè¦‹ãŸç›®ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒå®Œæˆã—ã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/cc60ad18bfec-20220925.png)

# ã‚³ãƒ¼ãƒ‰

è¨˜äº‹ä¸­ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã‚‚ç½®ã„ã¦ã‚ã‚Šã¾ã™ã€‚

https://github.com/zaki-yama-labs/gas-form-dialog-example

# å‚è€ƒãƒªãƒ³ã‚¯

- [HTML Service: Create and Serve HTML Â |Â  Apps Script Â |Â  Google Developers](https://developers.google.com/apps-script/guides/html)
- [HTML Service: Communicate with Server Functions Â |Â  Apps Script Â |Â  Google Developers](https://developers.google.com/apps-script/guides/html/communication)
- [Custom dialog in Google Sheets](https://spreadsheet.dev/custom-dialog-in-google-sheets#build-data-entry-forms-within-custom-dialogs-in-google-sheets-using-apps-script)
- [[GAS] Google Apps Script ã® HtmlService ã¾ã¨ã‚ - dackdive's blog](https://dackdive.hateblo.jp/entry/2015/02/01/010540)
